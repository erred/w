syntax = "proto3";

package saver.v1;

option go_package = "go.seankhliao.com/apis/saver";

service Saver {
  // HTTP records a HTTP request
  // Sent by middleware setup in go.seankhliao.com/usvc
  rpc HTTP(HTTPRequest) returns (HTTPResponse);

  // Beacon records a beacon sent by webpages
  // Sent by beacons in webpages generated by go.seankhliao.com/webstyle
  // Transformed by statslogger
  rpc Beacon(BeaconRequest) returns(BeaconResponse);

  // CSP records an instance of a Content Security Policy report
  // Sent by browsers in reponse to CSP headers sent by go.seankhliao.com/com-seankhliao
  // Transformed by statslogger
  rpc CSP(CSPRequest) returns (CSPResponse);

  // GHDefaults records an instance of setting repository defaults
  // Sent by go.seankhliao.com/ghdefaults
  rpc RepoDefault(RepoDefaultRequest) returns (RepoDefaultResponse);

  // // DMARC records an instance of a DMARC report
  // // Sent by email servers in response to DKIM SPF DMARC records
  // // TODO::Transformed by
  // rpc DMARC(DMARCRequest) returns (Result);

  // // CT records an instance of a Certificate Transpaency report
  // // TODO: Scraped from
  // // TODO::Transformed by
  // rpc CT(CTRequest) returns (Result);

  // // MusicListen records an instance of listening to music
  // // TODO: Scraped from spotify by
  // // TODO::Transformed by
  // // rpc MusicListen(MusicListenRequest) returns (Result);

  // TODO: email, news, blog, rss, music release
}

message HTTPRemote {
  string timestamp = 1;

  string remote = 2;
  string user_agent = 3;
  string referrer = 4;
}

message HTTPRequest {
  HTTPRemote http_remote = 1;

  string method = 2;
  string domain = 3;
  string path = 4;
}
message HTTPResponse {}

message BeaconRequest {
  HTTPRemote http_remote = 1;

  int64 duration_ms = 2;
  string src_page = 3;
  string dst_page = 4;
}
message BeaconResponse{}

message CSPRequest {
  HTTPRemote http_remote = 1;

  string disposition = 2;
  string blocked_uri = 3;
  string source_file = 4;
  string document_uri = 5;
  string violated_directive = 6;
  string effective_directive = 7;
  int64 line_number = 8;
  int64 status_code = 9;
}
message CSPResponse {}

message RepoDefaultRequest {
  string timestamp = 1;
  string owner = 2;
  string repo = 3;
}
message RepoDefaultResponse {}
